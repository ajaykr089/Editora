"use strict";var e=require("@rte-editor/core");class t extends e.Plugin{constructor(){super({name:"bold",schema:{marks:{bold:{parseDOM:[{tag:"strong"},{tag:"b"},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM:()=>["strong",0]}}},commands:{toggleBold:o,setBold:n,unsetBold:r},toolbar:{items:[{id:"bold",icon:"B",label:"Bold",command:"toggleBold",active:e=>{const t=e.schema.marks.bold;return!!t&&t.isInSet(e.storedMarks||[])}}]},keybindings:{"Mod-b":"toggleBold","Mod-B":"toggleBold"}})}}function o(e,t){const o=e.schema.marks.bold;if(!o)return!1;const{from:n,to:r,empty:a}=e.selection;if(console.log("[toggleBold] Selection:",{from:n,to:r,empty:a},"dispatch:",!!t),a){if(t){const n=e.tr,r=e.storedMarks||[];o.isInSet(r)?n.setStoredMarks(r.filter(e=>e.type!==o)):n.setStoredMarks([...r,o.create()]),t(n)}return!0}if(t){const a=e.tr,s=e.doc.rangeHasMark(n,r,o);console.log("[toggleBold] Has mark:",s,"doc children:",e.doc.content.children.length),s?(console.log("[toggleBold] Removing mark"),a.removeMark(n,r,o)):(console.log("[toggleBold] Adding mark"),a.addMark(n,r,o.create())),t(a)}return!0}function n(e,t){const o=e.schema.marks.bold;if(!o)return!1;const{from:n,to:r,empty:a}=e.selection;if(a){if(t){const n=e.tr,r=e.storedMarks||[];o.isInSet(r)||n.setStoredMarks([...r,o.create()]),t(n)}return!0}if(t){const a=e.tr;e.doc.rangeHasMark(n,r,o)||a.addMark(n,r,o.create()),t(a)}return!0}function r(e,t){const o=e.schema.marks.bold;if(!o)return!1;const{from:n,to:r,empty:a}=e.selection;if(a){if(t){const n=e.tr,r=e.storedMarks||[];n.setStoredMarks(r.filter(e=>e.type!==o)),t(n)}return!0}if(t){const a=e.tr;a.removeMark(n,r,o),t(a)}return!0}class a extends e.Plugin{constructor(){super({name:"italic",commands:{toggleItalic:s},toolbar:{items:[{id:"italic",icon:"I",label:"Italic",command:"toggleItalic",active:e=>e.schema.marks.italic.isInSet(e.storedMarks||[])}]},keybindings:{"Mod-i":"toggleItalic","Mod-I":"toggleItalic"}})}}function s(e,t){const o=e.schema.marks.italic;if(!o)return!1;const{from:n,to:r,empty:a}=e.selection;if(a){if(t){const n=e.tr;e.storedMarks?n.setStoredMarks(e.storedMarks.filter(e=>e.type!==o)):n.setStoredMarks([o.create()]),t(n)}return!0}if(t){const a=e.tr;e.doc.rangeHasMark(n,r,o)?a.removeMark(n,r,o):a.addMark(n,r,o.create()),t(a)}return!0}class i extends e.Plugin{constructor(){super({name:"heading",commands:{setHeading:e=>c(e),toggleHeading:e=>function(e){return(t,o)=>l(t,e)?c(0)(t,o):c(e)(t,o)}(e)},toolbar:{items:[{id:"heading1",icon:"H1",label:"Heading 1",command:"setHeading",commandArgs:[1],active:e=>l(e,1)},{id:"heading2",icon:"H2",label:"Heading 2",command:"setHeading",commandArgs:[2],active:e=>l(e,2)},{id:"heading3",icon:"H3",label:"Heading 3",command:"setHeading",commandArgs:[3],active:e=>l(e,3)}]},keybindings:{"Mod-Alt-1":"setHeading(1)","Mod-Alt-2":"setHeading(2)","Mod-Alt-3":"setHeading(3)","Mod-Alt-4":"setHeading(4)","Mod-Alt-5":"setHeading(5)","Mod-Alt-6":"setHeading(6)","Mod-Alt-0":"setHeading(0)"}})}}function l(e,t){const{$from:o,$to:n}=e.selection;let r=!1;return e.doc.nodesBetween(o.pos,n.pos,e=>"heading"!==e.type.name||e.attrs.level!==t||(r=!0,!1)),r}function c(e){return(t,o)=>{const n=t.schema.nodes.heading,r=t.schema.nodes.paragraph;if(!n||!r)return!1;const{$from:a,$to:s}=t.selection;let i=!1;if(t.doc.nodesBetween(a.pos,s.pos,(e,t)=>"paragraph"!==e.type.name&&"heading"!==e.type.name||(i=!0,!1)),!i)return!1;if(o){const i=t.tr;0===e?i.setBlockType(a.pos,s.pos,r):i.setBlockType(a.pos,s.pos,n,{level:e}),o(i)}return!0}}class d extends e.Plugin{constructor(){super({name:"paragraph",schema:{nodes:{paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:()=>["p",0]}}},commands:{setParagraph:(e,t)=>{if(t){t(e.tr.setBlockType(e.selection.from,e.selection.to,e.schema.nodes.paragraph))}return!0}},toolbar:{items:[{id:"paragraph",icon:"P",label:"Paragraph",command:"setParagraph"}]}})}}class u extends e.Plugin{constructor(e={}){super({name:"history",commands:{undo:g,redo:m,clearHistory:p},toolbar:{items:[{id:"undo",icon:"â†¶",label:"Undo",command:"undo",enabled:e=>({done:[],undone:[],depth:100,newGroupDelay:500}.done.length>0)},{id:"redo",icon:"â†·",label:"Redo",command:"redo",enabled:e=>({done:[],undone:[],depth:100,newGroupDelay:500}.undone.length>0)}]},keybindings:{"Mod-z":"undo","Mod-y":"redo","Mod-Shift-z":"redo"},onTransaction:(e,t)=>{this.handleTransaction(e,t.state)}}),this.historyState={done:[],undone:[],depth:e.depth||100,newGroupDelay:e.newGroupDelay||500}}handleTransaction(e,t){const o=e.getMeta("history");"ignore"!==o&&("undo"!==o?"redo"!==o?(this.historyState.done.push(e),this.historyState.undone=[],this.historyState.done.length>this.historyState.depth&&this.historyState.done.shift()):this.historyState.done.push(e):this.historyState.undone.push(e))}}function g(e,t){const o={done:[],undone:[],depth:100,newGroupDelay:500};if(0===o.done.length)return!1;if(t){const n=o.done[o.done.length-1],r=e.tr.setMeta("history","undo");if(n.steps)for(let t=n.steps.length-1;t>=0;t--){const o=n.steps[t];if(o.invert){const t=o.invert(e);t&&r.step(t)}}t(r)}return!0}function m(e,t){const o={done:[],undone:[],depth:100,newGroupDelay:500};if(0===o.undone.length)return!1;if(t){const n=o.undone[o.undone.length-1],r=e.tr.setMeta("history","redo");if(n.steps)for(const e of n.steps)r.step(e);t(r)}return!0}function p(e,t){if(t){t(e.tr.setMeta("history","clear"))}return!0}class h extends e.Plugin{constructor(){super({name:"list",schema:{nodes:{bullet_list:{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>["ul",0]},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:e=>({order:e.hasAttribute("start")?+e.getAttribute("start"):1})}],toDOM:e=>1===e.attrs.order?["ol",0]:["ol",{start:e.attrs.order},0]},list_item:{content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM:()=>["li",0],defining:!0}}},commands:{toggleBulletList:k,toggleOrderedList:M,liftListItem:y,sinkListItem:B},toolbar:{items:[{id:"bullet-list",icon:"â€¢",label:"Bullet List",command:"toggleBulletList",active:e=>f(e)},{id:"ordered-list",icon:"1.",label:"Numbered List",command:"toggleOrderedList",active:e=>b(e)}]},keybindings:{"Mod-Shift-8":"toggleBulletList","Mod-Shift-7":"toggleOrderedList",Tab:"sinkListItem","Shift-Tab":"liftListItem"}})}}function f(e){const{from:t,to:o}=e.selection;let n=!1;return e.doc.nodesBetween(t,o,(e,t,o)=>{if(o&&"bullet_list"===o.type.name)return n=!0,!1}),n}function b(e){const{from:t,to:o}=e.selection;let n=!1;return e.doc.nodesBetween(t,o,(e,t,o)=>{if(o&&"ordered_list"===o.type.name)return n=!0,!1}),n}function k(t,o){const n=t.schema.nodes.bullet_list,r=t.schema.nodes.list_item,a=t.schema.nodes.paragraph;if(!n||!r||!a)return!1;if(f(t)){if(o){const n=t.doc,r=[];n.content.children.forEach(e=>{"bullet_list"===e.type.name?e.content.children.forEach(e=>{e.content.children.length>0&&r.push(e.content.children[0])}):r.push(e)});const a=n.type.create(n.attrs,e.Fragment.from(r));o(t.tr.setDoc(a))}return!0}if(o){const s=t.doc,{from:i,to:l}=t.selection,c=[],d=[];s.content.children.forEach(t=>{if("paragraph"===t.type.name){const o=a.create({},t.content);d.push(r.create({},e.Fragment.from([o])))}else d.length>0&&(c.push(n.create({},e.Fragment.from(d))),d.length=0),c.push(t)}),d.length>0&&c.push(n.create({},e.Fragment.from(d)));const u=s.type.create(s.attrs,e.Fragment.from(c));o(t.tr.setDoc(u))}return!0}function M(t,o){const n=t.schema.nodes.ordered_list,r=t.schema.nodes.list_item,a=t.schema.nodes.paragraph;if(!n||!r||!a)return!1;if(b(t)){if(o){const n=t.doc,r=[];n.content.children.forEach(e=>{"ordered_list"===e.type.name?e.content.children.forEach(e=>{e.content.children.length>0&&r.push(e.content.children[0])}):r.push(e)});const a=n.type.create(n.attrs,e.Fragment.from(r));o(t.tr.setDoc(a))}return!0}if(o){const s=t.doc,i=[],l=[];s.content.children.forEach(t=>{if("paragraph"===t.type.name){const o=a.create({},t.content);l.push(r.create({},e.Fragment.from([o])))}else l.length>0&&(i.push(n.create({},e.Fragment.from(l))),l.length=0),i.push(t)}),l.length>0&&i.push(n.create({},e.Fragment.from(l)));const c=s.type.create(s.attrs,e.Fragment.from(i));o(t.tr.setDoc(c))}return!0}function y(e,t){if(t){t(e.tr.lift(e.selection.from,e.selection.to))}return!0}function B(e,t){if(t){t(e.tr.wrap(e.selection.from,e.selection.to,e.schema.nodes.list_item))}return!0}class w extends e.Plugin{constructor(){super({name:"blockquote",schema:{nodes:{blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]}}},commands:{toggleBlockquote:(e,t)=>{const o=e.schema.nodes.blockquote,n=e.schema.nodes.paragraph;if(t){const{from:r,to:a}=e.selection,s=e.tr;let i=!1;e.doc.nodesBetween(r,a,(e,t,n)=>{if(n&&n.type===o)return i=!0,!1}),i?s.setBlockType(r,a,n):s.wrapIn(o),t(s)}return!0}},toolbar:{items:[{id:"blockquote",icon:"â",label:"Quote",command:"toggleBlockquote"}]},keybindings:{"Mod-Shift-.":"toggleBlockquote"}})}}class P extends e.Plugin{constructor(){super({name:"table",schema:{nodes:{table:{content:"table_row+",group:"block",isolating:!0,parseDOM:[{tag:"table"}],toDOM:()=>["table",{class:"rte-table"},["tbody",0]]},table_row:{content:"table_cell+",parseDOM:[{tag:"tr"}],toDOM:()=>["tr",0]},table_cell:{content:"block+",attrs:{colspan:{default:1},rowspan:{default:1}},parseDOM:[{tag:"td"},{tag:"th"}],toDOM:e=>{const t={};return 1!==e.attrs.colspan&&(t.colspan=e.attrs.colspan),1!==e.attrs.rowspan&&(t.rowspan=e.attrs.rowspan),["td",t,0]}}}},commands:{insertTable:D,addRowBefore:x,addRowAfter:A,addColumnBefore:H,addColumnAfter:O,deleteRow:S,deleteColumn:I,toggleHeaderRow:L},toolbar:{items:[{id:"insert-table",icon:"âŠž",label:"Insert Table",command:"insertTable"}]},keybindings:{"Mod-Alt-T":"insertTable"}})}}function D(t=3,o=3){return(n,r)=>{const a=n.schema.nodes.table,s=n.schema.nodes.table_row,i=n.schema.nodes.table_cell,l=n.schema.nodes.paragraph;if(!(a&&s&&i&&l))return!1;if(r){const c=n.tr,d=[];for(let n=0;n<t;n++){const t=[];for(let n=0;n<o;n++)t.push(i.create({},e.Fragment.from([l.create()])));d.push(s.create({},e.Fragment.from(t)))}const u=a.create({},e.Fragment.from(d));c.replaceSelectionWith(u),r(c)}return!0}}function x(e,t){return!1}function A(e,t){return!1}function H(e,t){return!1}function O(e,t){return!1}function S(e,t){return!1}function I(e,t){return!1}function L(e,t){return!1}class v extends e.Plugin{constructor(e={}){super({name:"image",schema:{nodes:{image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:e=>({src:e.getAttribute("src"),title:e.getAttribute("title"),alt:e.getAttribute("alt"),width:e.getAttribute("width"),height:e.getAttribute("height")})}],toDOM:e=>["img",e.attrs]}}},commands:{insertImage:(e,t)=>(o,n)=>{const r=o.schema.nodes.image;if(n){const a=e||prompt("Enter image URL:");if(a){const e={src:a};t&&(e.alt=t);const s=r.create(e);n(o.tr.replaceSelectionWith(s))}}return!0},uploadImage:t=>(o,n)=>{if(e.maxSize&&t.size>e.maxSize)return alert("File too large"),!1;const r=new FileReader;return r.onload=e=>{const r=e.target?.result;if(r&&n){const e=o.schema.nodes.image.create({src:r,alt:t.name}),a=o.tr.replaceSelectionWith(e);n(a)}},r.readAsDataURL(t),!0}},toolbar:{items:[{id:"image",icon:"ðŸ–¼ï¸",label:"Image",command:"insertImage"}]}})}}class _ extends e.Plugin{constructor(){super({name:"link",schema:{marks:{link:{attrs:{href:{},title:{default:null},target:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:e=>({href:e.getAttribute("href"),title:e.getAttribute("title"),target:e.getAttribute("target")})}],toDOM:e=>["a",e.attrs,0]}}},commands:{toggleLink:e=>(t,o)=>{const n=t.schema.marks.link,{from:r,to:a}=t.selection;if(o){const s=t.tr;if(t.doc.rangeHasMark(r,a,n))s.removeMark(r,a,n);else{const t=e||prompt("Enter URL:");t&&s.addMark(r,a,n.create({href:t}))}o(s)}return!0},removeLink:(e,t)=>{const o=e.schema.marks.link,{from:n,to:r}=e.selection;if(t){t(e.tr.removeMark(n,r,o))}return!0}},toolbar:{items:[{id:"link",icon:"ðŸ”—",label:"Link",command:"toggleLink"},{id:"unlink",icon:"ðŸ”—âŒ",label:"Remove Link",command:"removeLink"}]},keybindings:{"Mod-k":"toggleLink"}})}}class T extends e.Plugin{constructor(){super({name:"codeblock",schema:{nodes:{code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,attrs:{language:{default:null}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:e=>({language:e.getAttribute("data-language")})}],toDOM:e=>["pre",e.attrs.language?{"data-language":e.attrs.language}:{},["code",0]]}},marks:{code:{parseDOM:[{tag:"code"}],toDOM:()=>["code",0]}}},commands:{toggleCodeBlock:(e,t)=>{const o=e.schema.nodes.code_block,n=e.schema.nodes.paragraph;if(t){const{from:r,to:a}=e.selection,s=e.tr;let i=!1;e.doc.nodesBetween(r,a,e=>{if(e.type===o)return i=!0,!1}),i?s.setBlockType(r,a,n):s.setBlockType(r,a,o),t(s)}return!0},toggleCode:(e,t)=>{const o=e.schema.marks.code,{from:n,to:r}=e.selection;if(t){const a=e.tr;e.doc.rangeHasMark(n,r,o)?a.removeMark(n,r,o):a.addMark(n,r,o.create()),t(a)}return!0}},toolbar:{items:[{id:"code_block",icon:"{ }",label:"Code Block",command:"toggleCodeBlock"},{id:"code",icon:"</>",label:"Inline Code",command:"toggleCode"}]},keybindings:{"Mod-Alt-c":"toggleCodeBlock","Mod-`":"toggleCode"}})}}exports.BlockquotePlugin=w,exports.BoldPlugin=t,exports.CodeBlockPlugin=T,exports.HeadingPlugin=i,exports.HistoryPlugin=u,exports.ImagePlugin=v,exports.ItalicPlugin=a,exports.LinkPlugin=_,exports.ListPlugin=h,exports.ParagraphPlugin=d,exports.TablePlugin=P,exports.createBlockquotePlugin=function(){return new w},exports.createBoldPlugin=function(){return new t},exports.createCodeBlockPlugin=function(){return new T},exports.createHeadingPlugin=function(){return new i},exports.createHistoryPlugin=function(e){return new u(e)},exports.createImagePlugin=function(e){return new v(e)},exports.createItalicPlugin=function(){return new a},exports.createLinkPlugin=function(){return new _},exports.createListPlugin=function(){return new h},exports.createParagraphPlugin=function(){return new d},exports.createTablePlugin=function(){return new P};
//# sourceMappingURL=index.cjs.js.map
