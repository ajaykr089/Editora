"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react/jsx-runtime"),t=require("react"),n=require("@rte-editor/core");const o=t.createContext(null),r=()=>{const e=t.useContext(o);if(!e)throw new Error("useEditorContext must be used within an EditorProvider");return e},s=({state:t,dispatch:n,plugins:r=[],editor:s,view:a,children:l})=>{const c={state:t,dispatch:n,plugins:r,editor:s,view:a};return e.jsx(o.Provider,{value:c,children:l})},a=({className:t,items:o})=>{const{state:s,editor:a}=r(),c=o||a.state.plugins.flatMap(e=>{const t=e.getToolbarConfig();return t?.items||[]});if(0===c.length)return e.jsxs("div",{className:`rte-toolbar ${t||""}`,children:[e.jsx("button",{className:"rte-toolbar-button",onMouseDown:e=>{e.preventDefault(),a.executeCommand("toggleBold")},title:"Bold",children:e.jsx("strong",{children:"B"})}),e.jsx("button",{className:"rte-toolbar-button",onMouseDown:e=>{e.preventDefault(),a.executeCommand("toggleItalic")},title:"Italic",children:e.jsx("em",{children:"I"})}),e.jsx("button",{className:"rte-toolbar-button",onMouseDown:e=>{e.preventDefault(),a.executeCommand("undo")},title:"Undo",children:"â†¶"})]});const i=(e,t)=>{const o=window.getSelection(),r=document.querySelector(".rte-content");if(o&&o.rangeCount>0&&r){const s=o.getRangeAt(0),l=u(r,s.startContainer,s.startOffset),c=u(r,s.endContainer,s.endOffset),i=n.ResolvedPos.resolve(a.state.doc,l),d=n.ResolvedPos.resolve(a.state.doc,c);a._state=a.state.update({selection:new n.TextSelection(i,d)}),a.executeCommand(e,...t||[]),requestAnimationFrame(()=>{const e=document.createRange(),t=document.createTreeWalker(r,NodeFilter.SHOW_TEXT);let n,s=0,a=null,i=0,u=null,d=0;for(;n=t.nextNode();){const e=(n.textContent||"").length;if(!a&&s+e>=l-1&&(a=n,i=l-1-s),!u&&s+e>=c-1){u=n,d=c-1-s;break}s+=e}if(a&&u)try{e.setStart(a,Math.max(0,i)),e.setEnd(u,Math.max(0,d)),o.removeAllRanges(),o.addRange(e)}catch(e){}r.focus()})}else a.executeCommand(e,...t||[])},u=(e,t,n)=>{let o=0;const r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT);let s;for(;s=r.nextNode();){if(s===t)return o+n+1;o+=(s.textContent||"").length}return o+1};return e.jsx("div",{className:`rte-toolbar ${t||""}`,children:c.map(t=>e.jsx(l,{item:t,state:s,onCommand:i},t.id))})},l=({item:t,state:n,onCommand:o})=>{const r=!!t.active&&t.active(n),s=!t.enabled||t.enabled(n);return e.jsxs("button",{type:"button",className:`rte-toolbar-button ${r?"rte-toolbar-button--active":""} ${!1===s?"rte-toolbar-button--disabled":""}`,onMouseDown:e=>{e.preventDefault(),!1!==s&&o(t.command,t.commandArgs)},disabled:!1===s,title:t.label,"aria-label":t.label,children:["string"==typeof t.icon?e.jsx("span",{className:"rte-toolbar-button__icon",children:t.icon}):t.icon,t.label&&e.jsx("span",{className:"rte-toolbar-button__label",children:t.label})]})};class c{constructor(e){this.savedRange=null,this.element=null,this.element=e||null}setElement(e){this.element=e}saveSelection(){this.save()}restoreSelection(){this.restore()}save(){const e=window.getSelection();e&&e.rangeCount>0&&this.element?.contains(e.anchorNode)&&(this.savedRange=e.getRangeAt(0).cloneRange())}restore(){if(this.savedRange&&this.element)try{const e=window.getSelection();e&&(e.removeAllRanges(),e.addRange(this.savedRange),this.element.focus())}catch(e){this.element.focus()}}preserveSelection(e){this.save();const t=e();return setTimeout(()=>this.restore(),0),t}getCursorOffset(){const e=window.getSelection();if(!e||0===e.rangeCount||!this.element)return 0;const t=e.getRangeAt(0),n=t.cloneRange();return n.selectNodeContents(this.element),n.setEnd(t.endContainer,t.endOffset),n.toString().length}setCursorOffset(e){if(!this.element)return;const t=document.createTreeWalker(this.element,NodeFilter.SHOW_TEXT,null);let n,o=0;for(;n=t.nextNode();){const t=n.textContent?.length||0;if(o+t>=e){const t=document.createRange();t.setStart(n,e-o),t.collapse(!0);const r=window.getSelection();return void(r&&(r.removeAllRanges(),r.addRange(t)))}o+=t}const r=document.createRange();r.selectNodeContents(this.element),r.collapse(!1);const s=window.getSelection();s&&(s.removeAllRanges(),s.addRange(r))}}const i=({className:n,placeholder:o,readOnly:s=!1,autoFocus:a=!1,spellCheck:l=!0})=>{const{state:i,editor:u}=r(),d=t.useRef(null),m=t.useRef(new c),g=t.useRef(!1),f=t.useRef("");t.useEffect(()=>{d.current&&u&&(u.setView({dom:d.current,focus:()=>{d.current?.focus()},blur:()=>{d.current?.blur()},updateState:e=>{}}),a&&setTimeout(()=>d.current?.focus(),0))},[u,a]);const h=t.useCallback(()=>{},[]),x=t.useCallback(()=>{g.current=!0},[]),p=t.useCallback(()=>{g.current=!1,h()},[h]),b=t.useCallback(e=>{if(s)return;e.preventDefault();const t=e.clipboardData,n=t.getData("text/html"),o=t.getData("text/plain"),r=n||o;r&&(m.current.saveSelection(),u.insertContent(r),setTimeout(()=>{m.current.restoreSelection()},0))},[s,u]),C=t.useCallback(e=>{if(s)return;e.preventDefault();const t=e.dataTransfer.getData("text/html")||e.dataTransfer.getData("text/plain");t&&u.insertContent(t)},[s,u]),v=t.useCallback(e=>{s||e.preventDefault()},[s]),w=t.useCallback(e=>{if(s)return;const t=e.key,n=e.ctrlKey||e.metaKey,o=e.shiftKey;if(e.altKey,n){let n="";switch(t.toLowerCase()){case"b":n="toggleBold";break;case"i":n="toggleItalic";break;case"u":n="toggleUnderline";break;case"z":n=o?"redo":"undo";break;case"y":n="redo";break;case"a":case"c":case"x":case"v":return}n&&(e.preventDefault(),R(),u.executeCommand(n))}switch(t){case"Enter":n&&(e.preventDefault(),u.executeCommand("insertHardBreak"));break;case"Tab":e.preventDefault(),o?u.executeCommand("liftListItem"):u.executeCommand("sinkListItem")}},[s,u]),R=t.useCallback(()=>{if(!d.current||!u)return;const e=window.getSelection();if(!e||0===e.rangeCount)return;const t=e.getRangeAt(0);if(!d.current.contains(t.commonAncestorContainer))return;const n=k(d.current,t.startContainer,t.startOffset),o=k(d.current,t.endContainer,t.endOffset),r=u.state.tr.setSelection(u.state.selection.constructor.create(u.state.doc,n,o));u.dispatch(r)},[u]),k=(e,t,n)=>{let o=0;const r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT);let s;for(;s=r.nextNode();){if(s===t)return o+n+1;o+=(s.textContent||"").length}return o+1},S=t.useCallback(()=>{},[]),N=t.useCallback(()=>{},[]);return t.useEffect(()=>{if(d.current&&u&&!g.current){const e=u.getHTML();e!==f.current&&(d.current.innerHTML=e,f.current=e)}},[i,u]),e.jsx("div",{ref:d,className:`rte-content ${n||""}`,contentEditable:!s,suppressContentEditableWarning:!0,spellCheck:l,onInput:h,onCompositionStart:x,onCompositionEnd:p,onPaste:b,onDrop:C,onDragOver:v,onKeyDown:w,onFocus:S,onBlur:N,"data-placeholder":o,role:"textbox","aria-multiline":"true","aria-label":"Rich text editor",style:{minHeight:"200px",padding:"16px",outline:"none",lineHeight:"1.6",wordWrap:"break-word",overflowWrap:"break-word"}})},u=({value:o,onChange:r,plugins:l=[],theme:c="light",readOnly:u=!1,placeholder:d,className:m,showToolbar:g=!0,...f})=>{const[h,x]=t.useState(null),[p,b]=t.useState(null);t.useEffect(()=>{const e=new n.Editor({content:o||"",plugins:l,onUpdate:({editor:e,transaction:t})=>{b(e.state),r?.(e.getHTML())}});return x(e),b(e.state),()=>{e.destroy()}},[o,l,r]);const C=t.useRef(null),v=["rte-editor",`rte-theme-${c}`,u&&"rte-readonly",m].filter(Boolean).join(" ");return h&&p?e.jsx(s,{state:p,dispatch:e=>h.dispatch(e),plugins:l,editor:h,children:e.jsxs("div",{ref:C,className:v,...f,children:[g&&e.jsx(a,{className:"rte-toolbar"}),e.jsx(i,{className:"rte-content",placeholder:d,readOnly:u})]})}):e.jsx("div",{className:"rte-loading",children:"Loading editor..."})};exports.EditorContent=i,exports.EditorProvider=s,exports.RichTextEditor=u,exports.Toolbar=a,exports.ToolbarButton=l,exports.default=u,exports.useCommand=e=>{const{state:n,dispatch:r}=t.useContext(o);return t.useMemo(()=>()=>{for(const t of n.plugins){const o=t.getCommands();if(o[e]){o[e](n,r);break}}},[n,r,e])},exports.useCommandEnabled=e=>{const{state:n}=t.useContext(o);return t.useMemo(()=>{for(const t of n.plugins){const o=t.getCommands();if(o[e])try{return!1!==o[e](n,void 0)}catch{return!1}}return!1},[n,e])},exports.useDispatch=()=>{const{dispatch:e}=t.useContext(o);return e},exports.useEditor=()=>{const{state:e}=t.useContext(o);return e},exports.useEditorContext=r,exports.useFocused=()=>!1,exports.usePlugins=()=>{const{plugins:e}=t.useContext(o);return e},exports.useSchema=()=>{const{state:e}=t.useContext(o);return e.schema},exports.useSelection=()=>{const{state:e}=t.useContext(o);return e.selection},exports.useView=()=>{const{view:e}=t.useContext(o);return e};
//# sourceMappingURL=index.cjs.js.map
