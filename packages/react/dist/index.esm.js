import{jsx as e,jsxs as t}from"react/jsx-runtime";import{createContext as n,useContext as r,useRef as o,useEffect as a,useCallback as s,useState as l,useMemo as c}from"react";import{ResolvedPos as i,TextSelection as u,Editor as d}from"@rte-editor/core";const m=n(null),g=()=>{const e=r(m);if(!e)throw new Error("useEditorContext must be used within an EditorProvider");return e},h=({state:t,dispatch:n,plugins:r=[],editor:o,view:a,children:s})=>{const l={state:t,dispatch:n,plugins:r,editor:o,view:a};return e(m.Provider,{value:l,children:s})},f=({className:n,items:r})=>{const{state:o,editor:a}=g(),s=r||a.state.plugins.flatMap(e=>{const t=e.getToolbarConfig();return t?.items||[]});if(0===s.length)return t("div",{className:`rte-toolbar ${n||""}`,children:[e("button",{className:"rte-toolbar-button",onMouseDown:e=>{e.preventDefault(),a.executeCommand("toggleBold")},title:"Bold",children:e("strong",{children:"B"})}),e("button",{className:"rte-toolbar-button",onMouseDown:e=>{e.preventDefault(),a.executeCommand("toggleItalic")},title:"Italic",children:e("em",{children:"I"})}),e("button",{className:"rte-toolbar-button",onMouseDown:e=>{e.preventDefault(),a.executeCommand("undo")},title:"Undo",children:"â†¶"})]});const l=(e,t)=>{const n=window.getSelection(),r=document.querySelector(".rte-content");if(n&&n.rangeCount>0&&r){const o=n.getRangeAt(0),s=c(r,o.startContainer,o.startOffset),l=c(r,o.endContainer,o.endOffset),d=i.resolve(a.state.doc,s),m=i.resolve(a.state.doc,l);a._state=a.state.update({selection:new u(d,m)}),a.executeCommand(e,...t||[]),requestAnimationFrame(()=>{const e=document.createRange(),t=document.createTreeWalker(r,NodeFilter.SHOW_TEXT);let o,a=0,c=null,i=0,u=null,d=0;for(;o=t.nextNode();){const e=(o.textContent||"").length;if(!c&&a+e>=s-1&&(c=o,i=s-1-a),!u&&a+e>=l-1){u=o,d=l-1-a;break}a+=e}if(c&&u)try{e.setStart(c,Math.max(0,i)),e.setEnd(u,Math.max(0,d)),n.removeAllRanges(),n.addRange(e)}catch(e){}r.focus()})}else a.executeCommand(e,...t||[])},c=(e,t,n)=>{let r=0;const o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT);let a;for(;a=o.nextNode();){if(a===t)return r+n+1;r+=(a.textContent||"").length}return r+1};return e("div",{className:`rte-toolbar ${n||""}`,children:s.map(t=>e(p,{item:t,state:o,onCommand:l},t.id))})},p=({item:n,state:r,onCommand:o})=>{const a=!!n.active&&n.active(r),s=!n.enabled||n.enabled(r);return t("button",{type:"button",className:`rte-toolbar-button ${a?"rte-toolbar-button--active":""} ${!1===s?"rte-toolbar-button--disabled":""}`,onMouseDown:e=>{e.preventDefault(),!1!==s&&o(n.command,n.commandArgs)},disabled:!1===s,title:n.label,"aria-label":n.label,children:["string"==typeof n.icon?e("span",{className:"rte-toolbar-button__icon",children:n.icon}):n.icon,n.label&&e("span",{className:"rte-toolbar-button__label",children:n.label})]})};class b{constructor(e){this.savedRange=null,this.element=null,this.element=e||null}setElement(e){this.element=e}saveSelection(){this.save()}restoreSelection(){this.restore()}save(){const e=window.getSelection();e&&e.rangeCount>0&&this.element?.contains(e.anchorNode)&&(this.savedRange=e.getRangeAt(0).cloneRange())}restore(){if(this.savedRange&&this.element)try{const e=window.getSelection();e&&(e.removeAllRanges(),e.addRange(this.savedRange),this.element.focus())}catch(e){this.element.focus()}}preserveSelection(e){this.save();const t=e();return setTimeout(()=>this.restore(),0),t}getCursorOffset(){const e=window.getSelection();if(!e||0===e.rangeCount||!this.element)return 0;const t=e.getRangeAt(0),n=t.cloneRange();return n.selectNodeContents(this.element),n.setEnd(t.endContainer,t.endOffset),n.toString().length}setCursorOffset(e){if(!this.element)return;const t=document.createTreeWalker(this.element,NodeFilter.SHOW_TEXT,null);let n,r=0;for(;n=t.nextNode();){const t=n.textContent?.length||0;if(r+t>=e){const t=document.createRange();t.setStart(n,e-r),t.collapse(!0);const o=window.getSelection();return void(o&&(o.removeAllRanges(),o.addRange(t)))}r+=t}const o=document.createRange();o.selectNodeContents(this.element),o.collapse(!1);const a=window.getSelection();a&&(a.removeAllRanges(),a.addRange(o))}}const v=({className:t,placeholder:n,readOnly:r=!1,autoFocus:l=!1,spellCheck:c=!0})=>{const{state:i,editor:u}=g(),d=o(null),m=o(new b),h=o(!1),f=o("");a(()=>{d.current&&u&&(u.setView({dom:d.current,focus:()=>{d.current?.focus()},blur:()=>{d.current?.blur()},updateState:e=>{}}),l&&setTimeout(()=>d.current?.focus(),0))},[u,l]);const p=s(()=>{},[]),v=s(()=>{h.current=!0},[]),C=s(()=>{h.current=!1,p()},[p]),w=s(e=>{if(r)return;e.preventDefault();const t=e.clipboardData,n=t.getData("text/html"),o=t.getData("text/plain"),a=n||o;a&&(m.current.saveSelection(),u.insertContent(a),setTimeout(()=>{m.current.restoreSelection()},0))},[r,u]),x=s(e=>{if(r)return;e.preventDefault();const t=e.dataTransfer.getData("text/html")||e.dataTransfer.getData("text/plain");t&&u.insertContent(t)},[r,u]),N=s(e=>{r||e.preventDefault()},[r]),S=s(e=>{if(r)return;const t=e.key,n=e.ctrlKey||e.metaKey,o=e.shiftKey;if(e.altKey,n){let n="";switch(t.toLowerCase()){case"b":n="toggleBold";break;case"i":n="toggleItalic";break;case"u":n="toggleUnderline";break;case"z":n=o?"redo":"undo";break;case"y":n="redo";break;case"a":case"c":case"x":case"v":return}n&&(e.preventDefault(),T(),u.executeCommand(n))}switch(t){case"Enter":n&&(e.preventDefault(),u.executeCommand("insertHardBreak"));break;case"Tab":e.preventDefault(),o?u.executeCommand("liftListItem"):u.executeCommand("sinkListItem")}},[r,u]),T=s(()=>{if(!d.current||!u)return;const e=window.getSelection();if(!e||0===e.rangeCount)return;const t=e.getRangeAt(0);if(!d.current.contains(t.commonAncestorContainer))return;const n=D(d.current,t.startContainer,t.startOffset),r=D(d.current,t.endContainer,t.endOffset),o=u.state.tr.setSelection(u.state.selection.constructor.create(u.state.doc,n,r));u.dispatch(o)},[u]),D=(e,t,n)=>{let r=0;const o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT);let a;for(;a=o.nextNode();){if(a===t)return r+n+1;r+=(a.textContent||"").length}return r+1},R=s(()=>{},[]),k=s(()=>{},[]);return a(()=>{if(d.current&&u&&!h.current){const e=u.getHTML();e!==f.current&&(d.current.innerHTML=e,f.current=e)}},[i,u]),e("div",{ref:d,className:`rte-content ${t||""}`,contentEditable:!r,suppressContentEditableWarning:!0,spellCheck:c,onInput:p,onCompositionStart:v,onCompositionEnd:C,onPaste:w,onDrop:x,onDragOver:N,onKeyDown:S,onFocus:R,onBlur:k,"data-placeholder":n,role:"textbox","aria-multiline":"true","aria-label":"Rich text editor",style:{minHeight:"200px",padding:"16px",outline:"none",lineHeight:"1.6",wordWrap:"break-word",overflowWrap:"break-word"}})},C=({value:n,onChange:r,plugins:s=[],theme:c="light",readOnly:i=!1,placeholder:u,className:m,showToolbar:g=!0,...p})=>{const[b,C]=l(null),[w,x]=l(null);a(()=>{const e=new d({content:n||"",plugins:s,onUpdate:({editor:e,transaction:t})=>{x(e.state),r?.(e.getHTML())}});return C(e),x(e.state),()=>{e.destroy()}},[n,s,r]);const N=o(null),S=["rte-editor",`rte-theme-${c}`,i&&"rte-readonly",m].filter(Boolean).join(" ");return b&&w?e(h,{state:w,dispatch:e=>b.dispatch(e),plugins:s,editor:b,children:t("div",{ref:N,className:S,...p,children:[g&&e(f,{className:"rte-toolbar"}),e(v,{className:"rte-content",placeholder:u,readOnly:i})]})}):e("div",{className:"rte-loading",children:"Loading editor..."})},w=()=>{const{state:e}=r(m);return e},x=()=>{const{dispatch:e}=r(m);return e},N=()=>{const{state:e}=r(m);return e.selection},S=()=>!1,T=()=>{const{state:e}=r(m);return e.schema},D=()=>{const{plugins:e}=r(m);return e},R=e=>{const{state:t}=r(m);return c(()=>{for(const n of t.plugins){const r=n.getCommands();if(r[e])try{return!1!==r[e](t,void 0)}catch{return!1}}return!1},[t,e])},k=e=>{const{state:t,dispatch:n}=r(m);return c(()=>()=>{for(const r of t.plugins){const o=r.getCommands();if(o[e]){o[e](t,n);break}}},[t,n,e])},y=()=>{const{view:e}=r(m);return e};export{v as EditorContent,h as EditorProvider,C as RichTextEditor,f as Toolbar,p as ToolbarButton,C as default,k as useCommand,R as useCommandEnabled,x as useDispatch,w as useEditor,g as useEditorContext,S as useFocused,D as usePlugins,T as useSchema,N as useSelection,y as useView};
//# sourceMappingURL=index.esm.js.map
