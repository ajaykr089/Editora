"use strict";class t{constructor(t={}){this.batch=[],this.batchTimeout=null,this.config={maxBatchSize:10,maxBatchTime:16,enabled:!0,...t}}add(t){this.config.enabled?(this.batch.push(t),this.batch.length>=this.config.maxBatchSize?this.flushBatch():1===this.batch.length&&this.scheduleFlush()):this.flush([t])}flushBatch(){this.batch.length>0&&(this.flush([...this.batch]),this.batch=[],this.clearTimeout())}setOnFlush(t){this.onFlush=t}getBatchSize(){return this.batch.length}isEnabled(){return this.config.enabled}setEnabled(t){this.config.enabled=t,t||this.flushBatch()}flush(t){if(this.onFlush){const e=t[0]?.beforeState||{};this.onFlush(t,e)}}scheduleFlush(){this.clearTimeout(),this.batchTimeout=window.setTimeout(()=>{this.flushBatch()},this.config.maxBatchTime)}clearTimeout(){this.batchTimeout&&(window.clearTimeout(this.batchTimeout),this.batchTimeout=null)}destroy(){this.clearTimeout(),this.flushBatch()}}class e{constructor(t=250){this.timeoutId=null,this.delay=t}execute(t,...e){null!==this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{t(...e)},this.delay)}cancel(){null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}}class i{constructor(t={}){this.cleanupInterval=null,this.eventListeners=new Map,this.timeouts=new Set,this.intervals=new Set,this.config={maxMemoryMB:100,cleanupIntervalMs:3e4,autoCleanup:!0,...t},this.config.autoCleanup&&this.startAutoCleanup()}registerEventListener(t,e,i,r){const s=`${e}_${Math.random()}`;t.addEventListener(e,i,r),this.eventListeners.set(s,i)}registerTimeout(t){this.timeouts.add(t)}registerInterval(t){this.intervals.add(t)}unregisterTimeout(t){this.timeouts.delete(t)}unregisterInterval(t){this.intervals.delete(t)}forceGC(){window.gc&&window.gc()}getMemoryUsage(){const t=performance.memory;return t?{used:Math.round(t.usedJSHeapSize/1024/1024),total:Math.round(t.totalJSHeapSize/1024/1024),limit:Math.round(t.jsHeapSizeLimit/1024/1024)}:null}isMemoryHigh(){const t=this.getMemoryUsage();return!!t&&t.used>this.config.maxMemoryMB}cleanup(){for(const t of this.timeouts)clearTimeout(t);this.timeouts.clear();for(const t of this.intervals)clearInterval(t);this.intervals.clear(),this.forceGC()}startAutoCleanup(){this.cleanupInterval=window.setInterval(()=>{this.isMemoryHigh()&&this.cleanup()},this.config.cleanupIntervalMs)}stopAutoCleanup(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}destroy(){this.stopAutoCleanup(),this.cleanup(),this.eventListeners.clear()}}class r{constructor(t={}){this.metrics=[],this.isMonitoring=!1,this.sampleInterval=null,this.currentOperation=null,this.config={enabled:!0,sampleInterval:5e3,maxSamples:100,logWarnings:!0,...t},this.config.enabled&&this.startMonitoring()}startMonitoring(){this.isMonitoring||(this.isMonitoring=!0,this.sampleInterval=window.setInterval(()=>{this.collectMetrics()},this.config.sampleInterval))}stopMonitoring(){this.isMonitoring&&(this.isMonitoring=!1,this.sampleInterval&&(clearInterval(this.sampleInterval),this.sampleInterval=null))}startOperation(t){if(!this.config.enabled)return;const e=performance.memory;this.currentOperation={type:t,startTime:performance.now(),memoryStart:e?e.usedJSHeapSize:0}}endOperation(){if(!this.config.enabled||!this.currentOperation)return null;const t=performance.now(),e=performance.memory,i=e?e.usedJSHeapSize:0,r={domTime:0,renderTime:t-this.currentOperation.startTime,transactionTime:t-this.currentOperation.startTime,memoryUsage:Math.round((i-this.currentOperation.memoryStart)/1024/1024),timestamp:Date.now()};switch(this.currentOperation.type){case"transaction":r.transactionTime=t-this.currentOperation.startTime;break;case"render":r.renderTime=t-this.currentOperation.startTime;break;case"dom":r.domTime=t-this.currentOperation.startTime}return this.addMetrics(r),this.currentOperation=null,this.config.logWarnings&&this.checkPerformanceWarnings(r),r}getMetrics(){return[...this.metrics]}getAverageMetrics(t=6e4){const e=Date.now()-t,i=this.metrics.filter(t=>t.timestamp>e);if(0===i.length)return{};const r=i.reduce((t,e)=>({domTime:t.domTime+e.domTime,renderTime:t.renderTime+e.renderTime,transactionTime:t.transactionTime+e.transactionTime,memoryUsage:t.memoryUsage+e.memoryUsage}),{domTime:0,renderTime:0,transactionTime:0,memoryUsage:0});return{domTime:Math.round(r.domTime/i.length),renderTime:Math.round(r.renderTime/i.length),transactionTime:Math.round(r.transactionTime/i.length),memoryUsage:Math.round(r.memoryUsage/i.length)}}clearMetrics(){this.metrics=[]}collectMetrics(){const t=performance.memory;if(!t)return;const e={domTime:0,renderTime:0,transactionTime:0,memoryUsage:Math.round(t.usedJSHeapSize/1024/1024),timestamp:Date.now()};this.addMetrics(e)}addMetrics(t){this.metrics.push(t),this.metrics.length>this.config.maxSamples&&(this.metrics=this.metrics.slice(-this.config.maxSamples))}checkPerformanceWarnings(t){const e=[];t.renderTime>16&&e.push(`Slow render: ${t.renderTime}ms`),t.transactionTime>100&&e.push(`Slow transaction: ${t.transactionTime}ms`),t.memoryUsage>50&&e.push(`High memory usage: ${t.memoryUsage}MB`),e.length>0&&console.warn("Performance warning:",e.join(", "))}destroy(){this.stopMonitoring(),this.clearMetrics()}}exports.Debouncer=e,exports.MemoryManager=i,exports.PerformanceMonitor=r,exports.TransactionBatcher=t,exports.createDebouncer=function(t){return new e(t)},exports.createMemoryManager=function(t){return new i(t)},exports.createPerformanceMonitor=function(t){return new r(t)},exports.createTransactionBatcher=function(e){return new t(e)};
//# sourceMappingURL=index.cjs.js.map
