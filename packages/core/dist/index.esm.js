class t{constructor(t=[]){this.content=t}static from(e){return new t(e)}static fromJSON(e,s){const r=s.map(t=>n.fromJSON(e,t));return new t(r)}get childCount(){return this.content.length}get children(){return this.content}child(t){if(t<0||t>=this.content.length)throw new Error(`Index ${t} out of bounds`);return this.content[t]}get firstChild(){return this.content.length>0?this.content[0]:null}get lastChild(){return this.content.length>0?this.content[this.content.length-1]:null}findChildAt(t){let e=0;for(const s of this.content){const n=s.nodeSize;if(t>=e&&t<e+n)return{node:s,offset:e};e+=n}if(t===e&&this.content.length>0){const t=this.content[this.content.length-1];return{node:t,offset:e-t.nodeSize}}return null}get size(){return this.content.reduce((t,e)=>t+e.nodeSize,0)}append(e){return new t([...this.content,e])}cut(e=0,s){const n=s??this.size;if(0===e&&n===this.size)return this;const r=[];let i=0;for(const t of this.content){const s=t.nodeSize;if(i+s<=e){i+=s;continue}if(i>=n)break;const o=Math.max(0,e-i),a=Math.min(s,n-i);if(0===o&&a===s)r.push(t);else{const e=t.cut(o,a);e&&r.push(e)}i+=s}return new t(r)}replace(t,e,s){const n=this.cut(0,t),r=this.cut(e);return n.appendFragment(s).appendFragment(r)}appendFragment(e){return new t([...this.content,...e.content])}equals(t){if(this.content.length!==t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].equals(t.content[e]))return!1;return!0}toJSON(){return this.content.map(t=>t.toJSON())}get textContent(){return this.content.map(t=>t.textContent).join("")}toString(){return this.content.map(t=>t.toString()).join("")}}class e{constructor(t,e={}){this.type=t,this.attrs=e}static create(t,s={}){return new e(t,s)}static fromJSON(t,s){const n=t.marks[s.type];if(!n)throw new Error(`Unknown mark type: ${s.type}`);const r=s.attrs||{};return new e(n,r)}isInSet(t){return t.some(t=>t.type===this.type&&this.attrsEqual(t.attrs))}addToSet(t){return[...t.filter(t=>t.type!==this.type).filter(t=>!this.type.excludes(t.type)),this]}removeFromSet(t){return t.filter(t=>!(t.type===this.type&&this.attrsEqual(t.attrs)))}static removeFromSet(t,e){return t.filter(t=>t.type!==e)}attrsEqual(t){const e=Object.keys(this.attrs),s=Object.keys(t);if(e.length!==s.length)return!1;for(const s of e)if(this.attrs[s]!==t[s])return!1;return!0}equals(t){return this.type===t.type&&this.attrsEqual(t.attrs)}toJSON(){const t={type:this.type.name};return Object.keys(this.attrs).length>0&&(t.attrs=this.attrs),t}toString(){const t=Object.keys(this.attrs).length>0?`(${Object.entries(this.attrs).map(([t,e])=>`${t}=${e}`).join(", ")})`:"";return`<${this.type.name}${t}>`}}class s{constructor(t,e,s){this.name=t,this.spec=e,this.schema=s}excludes(t){const e=this.spec.excludes;return!!e&&("string"==typeof e?e===t.name||e===(t.spec.group||""):e.includes(t.name)||e.includes(t.spec.group||""))}create(t={}){return e.create(this,t)}isInSet(t){for(const e of t)if(e.type===this)return!0;return!1}}class n{constructor(e,s={},n,r=[]){this.type=e,this.attrs=s,this.content=n||t.from([]),this.marks=r,this.validate()}static create(t,e={},s,r=[]){return new n(t,e,s,r)}static text(t,e=[]){return new n({name:"text",isText:!0},{text:t},void 0,e)}static fromJSON(s,r){const i=s.nodes[r.type];if(!i)throw new Error(`Unknown node type: ${r.type}`);const o=r.attrs||{},a=r.content?t.fromJSON(s,r.content):void 0,c=(r.marks||[]).map(t=>e.fromJSON(s,t));return new n(i,o,a,c)}validate(){this.type.isBlock&&0===this.content.size&&this.type.spec.content?.includes("empty")}get isBlock(){return this.type.isBlock}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return 0===this.content.childCount}replace(t,e,s){if(this.isText){const n=this.attrs.text||"",r=n.slice(0,t),i=n.slice(e),o=r+s.textContent+i;return this.withText(o)}const n=this.content.replace(t,e,s);return this.withContent(n)}get textContent(){if(this.isText)return this.attrs.text||"";let t="";return this.content.children.forEach(e=>{t+=e.textContent}),t}get nodeSize(){return this.isText?(this.attrs.text||"").length:1+this.content.size}withAttrs(t){return new n(this.type,{...this.attrs,...t},this.content,this.marks)}withContent(t){return new n(this.type,this.attrs,t,this.marks)}withMarks(t){return new n(this.type,this.attrs,this.content,t)}withText(t){if(!this.isText)throw new Error("Can only set text on text nodes");return new n(this.type,{...this.attrs,text:t},this.content,this.marks)}slice(e,s){if(this.isText){const n=this.attrs.text||"",r=s??n.length,i=n.slice(e,r);return i?t.from([this.withText(i)]):t.from([])}return this.content}cut(t,e){if(this.isText){const s=this.attrs.text||"",n=e??s.length;if(0===t&&n===s.length)return this;const r=s.slice(t,n);return r?this.withText(r):null}return 0===t&&(void 0===e||e>=this.nodeSize)?this:null}nodeAt(t){if(0===t)return this;if(this.isText)return t<=(this.attrs.text||"").length?this:null;const e=this.content.findChildAt(t-1);return e?e.node.nodeAt(t-1-e.offset):null}nodesBetween(t,e,s,n=0){if(this.isText)return void s(this,n,null);let r=n;this.content.children.forEach((n,i)=>{const o=r+1,a=o+n.nodeSize;if(a>t&&o<e){!1===s(n,o,this)||n.isText||n.nodesBetween(Math.max(0,t-o),Math.min(n.nodeSize,e-o),s,o)}r=a})}rangeHasMark(t,e,s){if(this.isText)return this.marks.some(t=>t.type===s);let n=!1,r=!0,i=1;for(const o of this.content.children){const a=i,c=i+o.nodeSize;if(o.isText&&c>t&&a<e){if(n=!0,!o.marks.some(t=>t.type===s)){r=!1;break}}else if(!o.isText&&c>t&&a<e){if(!o.rangeHasMark(Math.max(0,t-a),Math.min(o.nodeSize,e-a),s)){r=!1;break}n=!0}i=c}return n&&r}removeMark(e,s,n){if(this.isText){const t=this.marks.filter(t=>t.type!==n);return this.withMarks(t)}const r=[];let i=1;return this.content.children.forEach(t=>{const o=i,a=i+t.nodeSize;if(t.isText&&a>e&&o<s){const i=t.attrs.text||"",a=Math.max(0,e-o),c=Math.min(i.length,s-o+1);a>0&&r.push(t.withText(i.slice(0,a)));const h=i.slice(a,c);if(h){const e=t.withText(h).withMarks(t.marks.filter(t=>t.type!==n));r.push(e)}c<i.length&&r.push(t.withText(i.slice(c)))}else!t.isText&&a>e&&o<s?r.push(t.removeMark(Math.max(0,e-o),Math.min(t.nodeSize,s-o),n)):r.push(t);i=a}),this.withContent(t.from(r))}addMark(e,s,n){if(this.isText){const t=n.addToSet(this.marks);return this.withMarks(t)}const r=[];let i=1;return this.content.children.forEach((t,o)=>{const a=i,c=i+t.nodeSize;if(t.isText&&c>e&&a<s){const i=t.attrs.text||"",o=Math.max(0,e-a),c=Math.min(i.length,s-a+1);o>0&&r.push(t.withText(i.slice(0,o)));const h=i.slice(o,c);if(h){const e=t.withText(h).withMarks(n.addToSet(t.marks));r.push(e)}c<i.length&&r.push(t.withText(i.slice(c)))}else!t.isText&&c>e&&a<s?r.push(t.addMark(Math.max(0,e-a),Math.min(t.nodeSize,s-a),n)):r.push(t);i=c}),this.withContent(t.from(r))}canJoin(t){return this.type===t.type&&this.type.spec.content===t.type.spec.content}join(t){if(!this.canJoin(t))throw new Error("Cannot join incompatible nodes");return this.isText&&t.isText?this.withText(this.textContent+t.textContent):this.withContent(this.content.appendFragment(t.content))}equals(t){if(this.type!==t.type)return!1;if(!this.attrsEqual(t.attrs))return!1;if(!this.content.equals(t.content))return!1;if(this.marks.length!==t.marks.length)return!1;for(let e=0;e<this.marks.length;e++)if(!this.marks[e].equals(t.marks[e]))return!1;return!0}attrsEqual(t){const e=Object.keys(this.attrs),s=Object.keys(t);if(e.length!==s.length)return!1;for(const s of e)if(this.attrs[s]!==t[s])return!1;return!0}toJSON(){const e={type:this.type.name};return Object.keys(this.attrs).length>0&&(e.attrs=this.attrs),this.content.equals(t.from([]))||(e.content=this.content.toJSON()),this.marks.length>0&&(e.marks=this.marks.map(t=>t.toJSON())),e}toString(){if(this.isText)return this.attrs.text||"";const t=Object.keys(this.attrs).length>0?`(${Object.entries(this.attrs).map(([t,e])=>`${t}=${e}`).join(", ")})`:"";if(this.isLeaf)return`<${this.type.name}${t} />`;const e=this.content.toString();return`<${this.type.name}${t}>${e}</${this.type.name}>`}}n.schema=null;class r{constructor(t,e,s){this.name=t,this.spec=e,this.schema=s}get isBlock(){return!this.spec.inline&&!this.spec.isText}get isInline(){return!!this.spec.inline}get isText(){return!!this.spec.isText}create(t={},e,s=[]){return n.create(this,t,e,s)}}class i{static atStart(t){return o.create(t,0)}static atEnd(t){return o.create(t,t.content.size)}static create(t,e,s){return void 0===s||e===s?o.create(t,e):new o(c.resolve(t,e),c.resolve(t,s))}get content(){return new h(this.$from.doc.slice(this.from,this.to),0,0)}}class o extends i{constructor(t,e){super(),this.$from=t,this.$to=e||t,this.from=t.pos,this.to=this.$to.pos}get empty(){return this.from===this.to}static create(t,e){return new o(c.resolve(t,e))}equals(t){return t instanceof o&&this.$from.pos===t.$from.pos&&this.$to.pos===t.$to.pos}map(t,e){const s=e.map(this.from),n=e.map(this.to);return o.create(t,Math.min(s,n))}toJSON(){return{type:"text",from:this.from,to:this.to}}}class a extends i{constructor(t){super(),this.$from=t,this.$to=c.resolve(t.doc,t.pos+t.nodeAfter.nodeSize),this.from=t.pos,this.to=this.$to.pos,this.node=t.nodeAfter}get empty(){return!1}static create(t,e){const s=c.resolve(t,e);if(!s.nodeAfter)throw new Error("No node at position "+e);return new a(s)}equals(t){return t instanceof a&&this.$from.pos===t.$from.pos}map(t,e){const s=e.map(this.from);try{return a.create(t,s)}catch{return o.create(t,s)}}toJSON(){return{type:"node",from:this.from,to:this.to}}}class c{constructor(t,e,s,n){this.pos=t,this.doc=e,this.depth=s,this.parentOffset=n}static resolve(t,e){e<0&&(e=0),e>t.content.size&&(e=t.content.size);let s=0,n=e,r=t;for(;s<100&&n>0;){const t=r.content.findChildAt(n-1);if(!t)break;if(!(n<=t.offset+t.node.nodeSize))break;s++,n-=t.offset,r=t.node}return new c(e,t,s,n)}get node(){return this.doc.nodeAt(this.pos)}get nodeAfter(){return this.doc.nodeAt(this.pos)}get nodeBefore(){return this.pos>0?this.doc.nodeAt(this.pos-1):null}parent(t){const e=t??this.depth-1;if(e<0)return this.doc;let s=this;for(let t=this.depth;t>e;t--)s=s.parentPos();return s.node}parentPos(){let t=0;this.doc;const e=this.path();for(let s=0;s<e.length-1;s++)t+=e[s].offset+1,e[s].node;return c.resolve(this.doc,t)}path(){const t=[];let e=0,s=this.doc;for(;e<this.pos;){const n=s.content.findChildAt(e);if(!n)break;t.push({node:n.node,offset:n.offset}),e+=n.offset,s=n.node}return t}get isAtStart(){return 0===this.parentOffset}get isAtEnd(){return this.parentOffset===this.parent().content.size}}class h{constructor(t,e,s){this.content=t,this.openStart=e,this.openEnd=s}}class l{constructor(t){this.doc=t.doc,this.schema=t.schema,this.selection=t.selection||i.atStart(this.doc),this.plugins=Object.freeze(t.plugins||[]),this.version=t.version||0,this.storedMarks=t.storedMarks||null}static create(t){return new l(t)}update(t){return new l({doc:t.doc??this.doc,schema:t.schema??this.schema,selection:t.selection??this.selection,plugins:t.plugins??this.plugins,version:(t.version??this.version)+1})}apply(t){return t.apply(this)}get tr(){return new u(this)}equals(t){return this.doc===t.doc&&this.schema===t.schema&&this.selection.equals(t.selection)&&this.plugins===t.plugins&&this.version===t.version}get storedMarksGetter(){return this.storedMarks}get isEditable(){return!0}}class u{constructor(t){this.steps=[],this.metadata=new Map,this.updated={},this.before=t}apply(t=this.before){let e=t;for(const t of this.steps){const s=t.apply(e);if(s.failed)throw new Error(`Transaction failed: ${s.failed}`);e=s.state}return Object.keys(this.updated).length>0&&(e=e.update(this.updated)),e}step(t){return this.steps.push(t),this}setDoc(t){return this.updated.doc=t,this}setSelection(t){return this.updated.selection=t,this}setMeta(t,e){return this.metadata.set(t,e),this}getMeta(t){return this.metadata.get(t)}setStoredMarks(t){return this.updated.storedMarks=t,this}addMark(t,e,s){const n=new d(t,e,s);return this.step(n)}removeMark(t,e,s){const n=new p(t,e,s);return this.step(n)}insertText(e,s,r){const i=new g(e,e,t.from([n.text(s,r)]));return this.step(i)}replace(t,e,s){const n=new g(t,e,s);return this.step(n)}setBlockType(e,s,n,r){const i=this.updated.doc||this.before.doc,o=[];i.content.children.forEach((t,i)=>{const a=0===i?1:o.reduce((t,e)=>t+e.nodeSize,1);a+t.nodeSize>e&&a<s&&!t.isText?o.push(n.create(r||{},t.content,t.marks)):o.push(t)});const a=i.type.create(i.attrs,t.from(o));return this.updated.doc=a,this}wrapIn(e,s){const n=this.updated.doc||this.before.doc,{from:r,to:i}=this.before.selection,o=[],a=[];n.content.children.forEach((n,c)=>{const h=0===c?1:o.reduce((t,e)=>t+e.nodeSize,1)+a.reduce((t,e)=>t+e.nodeSize,0);h+n.nodeSize>r&&h<i&&!n.isText?a.push(n):(a.length>0&&(o.push(e.create(s||{},t.from(a))),a.length=0),o.push(n))}),a.length>0&&o.push(e.create(s||{},t.from(a)));const c=n.type.create(n.attrs,t.from(o));return this.updated.doc=c,this}get beforeState(){return this.before}}class d{constructor(t,e,s){this.from=t,this.to=e,this.mark=s}apply(t){const e=t.doc.addMark(this.from,this.to,this.mark);return{state:t.update({doc:e})}}}class p{constructor(t,e,s){this.from=t,this.to=e,this.markType=s}apply(t){const e=t.doc.removeMark(this.from,this.to,this.markType);return{state:t.update({doc:e})}}}class g{constructor(t,e,s){this.from=t,this.to=e,this.slice=s}apply(t){const e=t.doc.replace(this.from,this.to,this.slice);return{state:t.update({doc:e})}}}class m{constructor(t){this.spec=t,this.nodes=this.createNodeTypes(t.nodes),this.marks=this.createMarkTypes(t.marks,this)}createNodeTypes(t){const e={};for(const[s,n]of Object.entries(t))e[s]=new r(s,n,this);return e}createMarkTypes(t,e){const n={};for(const[r,i]of Object.entries(t))n[r]=new s(r,i,e);return n}allowsNodeType(t,e){const s=t.spec.content;if(!s)return!1;return s.split(/\s+/).some(t=>"text"===t?e.isText:"inline"===t?e.isInline:"block"===t?e.isBlock:e.name===t)}get text(){return this.nodes.text}get doc(){return this.nodes.doc}get paragraph(){return this.nodes.paragraph}toJSON(){return this.spec}}const f=new m({nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:()=>["p",0]},heading:{attrs:{level:{default:1,validate:t=>t>=1&&t<=6}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:t=>[`h${t.attrs.level}`,0]},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,attrs:{language:{default:null}},parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:()=>["pre",["code",0]]},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr"]},bullet_list:{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>["ul",0]},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:t=>({order:t.hasAttribute("start")?+t.getAttribute("start"):1})}],toDOM:t=>1===t.attrs.order?["ol",0]:["ol",{start:t.attrs.order},0]},list_item:{content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM:()=>["li",0],defining:!0},table:{content:"table_row+",group:"block",isolating:!0,parseDOM:[{tag:"table"}],toDOM:()=>["table",["tbody",0]]},table_row:{content:"table_cell+",parseDOM:[{tag:"tr"}],toDOM:()=>["tr",0]},table_cell:{content:"block+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null}},isolating:!0,parseDOM:[{tag:"td"},{tag:"th"}],toDOM:t=>{const e={};return 1!==t.attrs.colspan&&(e.colspan=t.attrs.colspan),1!==t.attrs.rowspan&&(e.rowspan=t.attrs.rowspan),t.attrs.colwidth&&(e.style=`width: ${t.attrs.colwidth.join(", ")}px`),["td",e,0]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br"]},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:t=>({src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt"),width:t.getAttribute("width"),height:t.getAttribute("height")})}],toDOM:t=>["img",t.attrs]},text:{group:"inline",isText:!0}},marks:{bold:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:t=>("string"==typeof t||"normal"!==t.style.fontWeight)&&null},{style:"font-weight=400",clearMark:t=>"strong"===t.type.name},{style:"font-weight",getAttrs:t=>"string"==typeof t&&/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}],toDOM:()=>["strong",0]},italic:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>["em",0]},underline:{parseDOM:[{tag:"u"},{style:"text-decoration=underline"}],toDOM:()=>["u",0]},strikethrough:{parseDOM:[{tag:"s"},{tag:"strike"},{style:"text-decoration=line-through"}],toDOM:()=>["s",0]},code:{parseDOM:[{tag:"code"}],toDOM:()=>["code",0]},link:{attrs:{href:{},title:{default:null},target:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:t=>({href:t.getAttribute("href"),title:t.getAttribute("title"),target:t.getAttribute("target")})}],toDOM:t=>["a",t.attrs,0]},subscript:{parseDOM:[{tag:"sub"}],toDOM:()=>["sub",0],excludes:"superscript"},superscript:{parseDOM:[{tag:"sup"}],toDOM:()=>["sup",0],excludes:"subscript"},highlight:{attrs:{color:{default:"yellow"}},parseDOM:[{tag:"mark",getAttrs:t=>({color:t.style.backgroundColor||"yellow"})}],toDOM:t=>["mark",{style:`background-color: ${t.attrs.color}`},0]}}});class y{constructor(t={}){this.destroyed=!1,this.dispatch=t=>{if(!this.destroyed)try{const e=this._state.apply(t),s=this._state;this.updateState(e,t),s.selection.equals(e.selection)||this.onSelectionUpdate?.({editor:this,selection:e.selection})}catch(t){throw console.error("[Editor] Dispatch error:",t),t}},this.plugins=t.plugins||[],this.onUpdate=t.onUpdate,this.onSelectionUpdate=t.onSelectionUpdate,this.onFocus=t.onFocus,this.onBlur=t.onBlur,this.editable=!1!==t.editable,this.schema=this.createMergedSchema(t.schema);const e=this.createDocument(t.content);this._state=l.create({doc:e,schema:this.schema,plugins:this.plugins,selection:i.atStart(e)}),this.initializePlugins()}createMergedSchema(t){const e=t||f,s={...e.spec.nodes},n={...e.spec.marks};return this.plugins.forEach(t=>{const e=t.getSchemaExtensions();e&&(e.nodes&&Object.assign(s,e.nodes),e.marks&&Object.assign(n,e.marks))}),new m({nodes:s,marks:n,topNode:e.spec.topNode})}get state(){return this._state}get isEditable(){return this.editable&&!this.destroyed}createDocument(e){return e instanceof n?e:"string"==typeof e?this.parseHTML(e):this.schema.nodes.doc.create({},t.from([this.schema.nodes.paragraph.create()]))}parseHTML(t){const e=(new DOMParser).parseFromString(`<div>${t}</div>`,"text/html");return this.parseDOMNode(e.body.firstChild||e.createElement("div"))}parseDOMNode(e){if(3===e.nodeType)return n.text(e.textContent||"");const s=e,r=s.tagName?.toLowerCase();let i=this.schema.nodes.paragraph,o={};switch(r){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":i=this.schema.nodes.heading,o.level=parseInt(r[1]);break;case"p":i=this.schema.nodes.paragraph;break;case"div":i=this.schema.nodes.doc}const a=[];for(let t=0;t<s.childNodes.length;t++){const e=this.parseDOMNode(s.childNodes[t]);e&&a.push(e)}return i.create(o,t.from(a))}initializePlugins(){const t={schema:this.schema,state:this._state,dispatch:this.dispatch.bind(this),view:this.view};this.plugins.forEach(e=>{e.init(t)})}updateState(t,e){this._state=t;const s={schema:this.schema,state:this._state,dispatch:this.dispatch,view:this.view};this.plugins.forEach(t=>{t.spec.onTransaction?.(e,s)}),this.onUpdate?.({editor:this,transaction:e})}getHTML(){return this.serializeToHTML(this._state.doc)}getJSON(){return this._state.doc.toJSON()}getText(){return this._state.doc.textContent}serializeToHTML(t){if(t.isText){let e=t.attrs.text||"";return t.marks.forEach(t=>{switch(t.type.name){case"bold":e=`<strong>${e}</strong>`;break;case"italic":e=`<em>${e}</em>`;break;case"underline":e=`<u>${e}</u>`;break;case"code":e=`<code>${e}</code>`}}),e}const e=this.getHTMLTag(t);if(!e)return t.content.children.map(t=>this.serializeToHTML(t)).join("");const s=this.getHTMLAttrs(t);return`<${e}${s?` ${s}`:""}>${t.content.children.map(t=>this.serializeToHTML(t)).join("")}</${e}>`}getHTMLTag(t){switch(t.type.name){case"doc":return null;case"paragraph":return"p";case"heading":return`h${t.attrs.level||1}`;case"blockquote":return"blockquote";case"code_block":return"pre";case"bullet_list":return"ul";case"ordered_list":return"ol";case"list_item":return"li";case"table":return"table";case"table_row":return"tr";case"table_cell":return"td";case"horizontal_rule":return"hr";default:return"div"}}getHTMLAttrs(t){const e=[];return"table_cell"===t.type.name&&(t.attrs.colspan>1&&e.push(`colspan="${t.attrs.colspan}"`),t.attrs.rowspan>1&&e.push(`rowspan="${t.attrs.rowspan}"`)),e.join(" ")}setContent(t){if(this.destroyed)return this;const e=this.createDocument(t),s=this._state.tr.setDoc(e).setSelection(i.atStart(e));return this.dispatch(s),this}insertContent(e,s){if(this.destroyed)return this;const r=s??this._state.selection.from,i="string"==typeof e?t.from([n.text(e)]):t.from([e]),o=this._state.tr.replace(r,r,i);return this.dispatch(o),this}deleteRange(e,s){if(this.destroyed)return this;const n=this._state.tr.replace(e,s,t.from([]));return this.dispatch(n),this}setSelection(t){if(this.destroyed)return this;const e=this._state.tr.setSelection(t);return this.dispatch(e),this}executeCommand(t,...e){if(this.destroyed)return!1;console.log("[executeCommand]",t,"args:",e);for(const s of this.plugins){const n=s.getCommands();if(n[t]){const r=n[t];if(console.log("[executeCommand] Found command in plugin:",s.name,"type:",typeof r),"function"==typeof r){if(e.length>0){const t=r(...e);if(console.log("[executeCommand] Command with args returned:",typeof t),"function"==typeof t){const e=t(this._state,this.dispatch,this.view);return console.log("[executeCommand] Result:",e),e}}const t=r(this._state,this.dispatch,this.view);return console.log("[executeCommand] Direct result:",t),t}}}return console.log("[executeCommand] Command not found:",t),!1}can(t,...e){if(this.destroyed)return!1;for(const s of this.plugins){const n=s.getCommands();if(n[t])return n[t](this._state,void 0,this.view,...e)}return!1}getCommands(){const t={};return this.plugins.forEach(e=>{Object.assign(t,e.getCommands())}),t}registerPlugin(t){return this.destroyed||(this.plugins.push(t),this.schema=this.createMergedSchema(f),this._state=this._state.update({schema:this.schema,plugins:this.plugins})),this}unregisterPlugin(t){if(this.destroyed)return this;const e=this.plugins.findIndex(e=>e.name===t);return-1!==e&&(this.plugins.splice(e,1),this.schema=this.createMergedSchema(f),this._state=this._state.update({schema:this.schema,plugins:this.plugins})),this}setView(t){this.view=t;const e={schema:this.schema,state:this._state,dispatch:this.dispatch,view:this.view};this.plugins.forEach(s=>{s.spec.onFocus&&t.dom?.addEventListener("focus",()=>{s.spec.onFocus?.(e),this.onFocus?.({editor:this})}),s.spec.onBlur&&t.dom?.addEventListener("blur",()=>{s.spec.onBlur?.(e),this.onBlur?.({editor:this})})})}focus(){return this.view?.focus(),this}blur(){return this.view?.blur(),this}setEditable(t){return this.editable=t,this}destroy(){if(this.destroyed)return;const t={schema:this.schema,state:this._state,dispatch:this.dispatch,view:this.view};this.plugins.forEach(e=>{e.spec.onDestroy?.(t)}),this.destroyed=!0}isEmpty(){return 0===this._state.doc.content.childCount||1===this._state.doc.content.childCount&&""===this._state.doc.content.firstChild?.textContent}getCharacterCount(){return this._state.doc.textContent.length}getWordCount(){return this._state.doc.textContent.trim().split(/\s+/).filter(t=>t.length>0).length}}class w{constructor(){this.commands=new Map,this.aliases=new Map}register(t,e){this.commands.set(t,e)}registerAll(t){Object.entries(t).forEach(([t,e])=>{this.register(t,e)})}alias(t,e){this.aliases.set(t,e)}execute(t,e,s,n,...r){const i=this.aliases.get(t)||t,o=this.commands.get(i);if(!o)return console.warn(`Command "${t}" not found`),!1;try{return o(e,s,n,...r)}catch(e){return console.error(`Error executing command "${t}":`,e),!1}}can(t,e,s,...n){const r=this.aliases.get(t)||t,i=this.commands.get(r);if(!i)return!1;try{return i(e,void 0,s,...n)}catch{return!1}}has(t){const e=this.aliases.get(t)||t;return this.commands.has(e)}getCommands(){const t={};return this.commands.forEach((e,s)=>{t[s]=e}),t}getCommandNames(){return Array.from(this.commands.keys())}unregister(t){this.commands.delete(t);for(const[e,s]of this.aliases.entries())s===t&&this.aliases.delete(e)}clear(){this.commands.clear(),this.aliases.clear()}}function b(){const t=new w;return t.registerAll({selectAll:x,insertText:k,deleteSelection:M,insertHardBreak:T,focus:O,blur:v}),t}function x(t,e){if(e){e(t.tr.setSelection(i.create(t.doc,0,t.doc.content.size)))}return!0}function k(t){return(e,s)=>{if(s){s(e.tr.insertText(e.selection.from,t,e.storedMarks))}return!0}}function M(e,s){const{from:n,to:r}=e.selection;if(n===r)return!1;if(s){s(e.tr.replace(n,r,t.from([])))}return!0}function T(e,s){const n=e.schema.nodes.hard_break;if(!n)return!1;if(s){s(e.tr.replace(e.selection.from,e.selection.to,t.from([n.create()])))}return!0}function O(t,e,s){return s?.focus(),!0}function v(t,e,s){return s?.blur(),!0}class S{constructor(t={}){this.config={allowedTags:["p","br","strong","em","u","s","h1","h2","h3","h4","h5","h6","ul","ol","li","blockquote","code","pre","a","img","table","tr","td","th"],allowedAttributes:{a:["href","title","target"],img:["src","alt","title","width","height"],td:["colspan","rowspan"],th:["colspan","rowspan"],"*":["class","style"]},allowDataUrls:!1,maxUrlLength:2048,urlValidator:t=>this.defaultUrlValidator(t),...t}}sanitize(t){const e=(new DOMParser).parseFromString(t,"text/html");return this.sanitizeElement(e.body),e.body.innerHTML}sanitizeElement(t){const e=Array.from(t.children);for(const s of e)this.isAllowedTag(s.tagName.toLowerCase())?(this.sanitizeAttributes(s),this.sanitizeElement(s)):t.removeChild(s)}isAllowedTag(t){return this.config.allowedTags.includes(t.toLowerCase())}sanitizeAttributes(t){const e=Array.from(t.attributes),s=t.tagName.toLowerCase();for(const n of e){const e=n.name.toLowerCase(),r=this.config.allowedAttributes[s]||[],i=this.config.allowedAttributes["*"]||[];r.includes(e)||i.includes(e)?"href"!==e&&"src"!==e||this.isValidUrl(n.value)||t.removeAttribute(n.name):t.removeAttribute(n.name)}}isValidUrl(t){return!(t.length>this.config.maxUrlLength)&&(!(t.startsWith("data:")&&!this.config.allowDataUrls)&&this.config.urlValidator(t))}defaultUrlValidator(t){try{if(t.startsWith("/")||t.startsWith("./")||t.startsWith("../")||t.startsWith("#"))return!0;if(t.startsWith("mailto:")||t.startsWith("tel:"))return!0;const e=new URL(t);if(!["http:","https:"].includes(e.protocol))return!1;const s=e.hostname;return!/^\d+\.\d+\.\d+\.\d+$/.test(s)||("localhost"===s||"127.0.0.1"===s)}catch{return!1}}}class C{static validateText(t){const e=[];(t.includes("<script")||t.includes("javascript:"))&&e.push("Potential XSS attempt detected");t.split(/\s+/).filter(t=>t.length>1e3).length>0&&e.push("Extremely long words detected");return this.calculateNestingLevel(t)>50&&e.push("Excessive element nesting detected"),{valid:0===e.length,warnings:e}}static calculateNestingLevel(t){let e=0,s=0;const n=/<\/?[a-zA-Z][^>]*>/g;let r;for(;null!==(r=n.exec(t));){const t=r[0];t.startsWith("</")?s=Math.max(0,s-1):t.endsWith("/>")||t.includes("br")||t.includes("img")||t.includes("input")||(s++,e=Math.max(e,s))}return e}static validateFile(t,e={}){const{maxSize:s=10485760,allowedTypes:n=[],allowEmpty:r=!0}=e;return r||0!==t.size?t.size>s?{valid:!1,error:`File size exceeds ${s} bytes`}:n.length>0&&!n.includes(t.type)?{valid:!1,error:`File type ${t.type} not allowed`}:{valid:!0}:{valid:!1,error:"File is empty"}}}function z(t){return new S(t)}const D=new S;class ${constructor(t){this.spec=t}get name(){return this.spec.name}get version(){return this.spec.version||"1.0.0"}init(t){this.spec.onInit?.(t)}destroy(t){this.spec.onDestroy?.(t)}onTransaction(t,e){this.spec.onTransaction?.(t,e)}onSelectionChange(t,e){this.spec.onSelectionChange?.(t,e)}onFocus(t){this.spec.onFocus?.(t)}onBlur(t){this.spec.onBlur?.(t)}getSchemaExtensions(){return this.spec.schema}getCommands(){return this.spec.commands||{}}getToolbarConfig(){return this.spec.toolbar}getMenuItems(){return this.spec.menus||[]}getKeyBindings(){return this.spec.keybindings||{}}getNodeViews(){return this.spec.nodeViews||{}}getMarkViews(){return this.spec.markViews||{}}}class A{constructor(){this.plugins=new Map,this.initialized=!1}register(t){this.plugins.has(t.name)?console.warn(`Plugin "${t.name}" is already registered`):(this.plugins.set(t.name,t),this.initialized&&this.initializePlugin(t))}unregister(t){const e=this.plugins.get(t);return!!e&&(this.initialized&&this.destroyPlugin(e),this.plugins.delete(t))}get(t){return this.plugins.get(t)}getAll(){return Array.from(this.plugins.values())}has(t){return this.plugins.has(t)}initialize(t){this.initialized=!0;for(const e of this.plugins.values())this.initializePlugin(e,t)}destroy(t){for(const e of this.plugins.values())this.destroyPlugin(e,t);this.initialized=!1}onTransaction(t,e){for(const s of this.plugins.values())s.onTransaction(t,e)}onSelectionChange(t,e){for(const s of this.plugins.values())s.onSelectionChange(t,e)}mergeSchemas(t){const e={...t.spec.nodes},s={...t.spec.marks};for(const t of this.plugins.values()){const n=t.getSchemaExtensions();n&&(n.nodes&&Object.assign(e,n.nodes),n.marks&&Object.assign(s,n.marks))}return new m({nodes:e,marks:s,topNode:t.spec.topNode})}getCommands(){const t={};for(const e of this.plugins.values()){const s=e.getCommands();Object.assign(t,s)}return t}getToolbarItems(){const t=[];for(const e of this.plugins.values()){const s=e.getToolbarConfig();s?.items&&t.push(...s.items)}return t}getKeyBindings(){const t={};for(const e of this.plugins.values()){const s=e.getKeyBindings();Object.assign(t,s)}return t}initializePlugin(t,e){try{e&&t.init(e)}catch(e){console.error(`Failed to initialize plugin "${t.name}":`,e)}}destroyPlugin(t,e){try{e&&t.destroy(e)}catch(e){console.error(`Failed to destroy plugin "${t.name}":`,e)}}clear(){this.plugins.clear(),this.initialized=!1}get size(){return this.plugins.size}}function _(){return new A}export{d as AddMarkStep,w as CommandManager,C as ContentValidator,y as Editor,l as EditorState,t as Fragment,e as Mark,s as MarkType,n as Node,a as NodeSelection,r as NodeType,$ as Plugin,A as PluginManager,p as RemoveMarkStep,g as ReplaceStep,c as ResolvedPos,S as Sanitizer,m as Schema,i as Selection,h as Slice,o as TextSelection,u as Transaction,b as createCommandManager,_ as createPluginManager,z as createSanitizer,D as defaultSanitizer,f as defaultSchema};
//# sourceMappingURL=index.esm.js.map
